# sed详解

sed是stream editor的简称，也就是流编辑器。它一次处理一行内容，处理时，把当前处理的行存储在临时缓冲区中，称为"pattern space"，接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有 改变，除非你使用重定向存储输出。



## 命令与选项

sed命令告诉sed如何处理由地址指定的各输入行，如果没有指定地址，则处理所有的输入行。


### sed命令

a ---- 在当前行后添加一行或多行。多行时除最后一行外，每行末尾需要用  "\" 续行

c ---- 用此符号后的新文本替换当前行中的文本。多行时除最后一行外，每行末尾需用 "\" 续行

i ---- 在当前行之前插入文本。多行时除最后一行外，每行末尾需用 "\" 续行

d ---- 删除行

h ---- 把模式空间里的内容复制到暂存缓冲区

H ---- 把模式空间里的内容追加到暂存缓冲区

g ---- 把暂存缓冲区里的内容复制到模式空间，覆盖原有的内容

G ---- 把暂存缓冲区里的内容追加到模式空间，追加在原有内容的后面

I ---- 列出非打印字符

p ---- 打印行

n ---- 读入下一输入行，并从下一条命令而不是第一条命令开始对其处理

q ---- 结束或者退出sed

r ---- 从文件中读取输入行

！---- 对所选行以外的所有行应用命令

s ---- 用一个字符串替换另一个字符串

w ---- 将所选的行写入文件

x ---- 交换暂存缓冲区与模式空间的内容

y ---- 将字符替换为另一个字符（不能对正则表达式使用y命令）

### sed选项

-e ---- 进行多项编辑，即对输入行应用多条sed命令时使用

-n ---- 取消默认的输出

-f ---- 指定sed脚本的文件名


## 正则表达式相关符号


 |元字符|功能 |示例|
 |------------|------------|------------|
|^|锚定行尾|/^my/  匹配所有以my开头的行|
|$|匹配除换行符以外的单个字符|/my$/   匹配所有以my结尾的行|
|.|匹配零个或多个前导符号|/m..y/   匹配包含字母m，后跟两个任意字符，再跟字母y的行|
|*|匹配指定字符组内的任一字符|/my*/   匹配包含字母m，后跟零个或者多个y字母的行|
|[ ]|匹配指定字符组内的任一字符|/[Mm]y/   匹配包含My或my的行|
|[^]|匹配不在指定字符组内的任一字符|/[^Mm]y/  匹配包含y，但在y之前的那个字符不是M或者m的行|
|\(..\)|保存已匹配的字符，后续用来引用该字符|1,20s/\(you)self/\1r/  标记元字符之间的模式，并将其保存为书签1，之后可以使用\1来引用它。最多可以定义9个书签，从左边开始编号，最左边的是第一个。此列中，对第1到20行进行处理，you被保存为书签1，如果发现youself，则替换为your.|
|&|保存查找串以便在替换中引用|s/my/**&**/   符号&代表查找串。my将被替换为 **my**|
|\<|词首定位符|/\<my/   匹配包含以my开头的单词的行|
|\>|词尾定位符|/my\>/   匹配包含以my结尾的单词的行|
|x\{m\}|连续m个x|/9\{5\}/  匹配包含连续5个9的行|
|x\{m,n\}|至少m个，但不超过n个x|/9\{5,7}/  匹配包含连续5到7个9的行|	


## 示例

### a命令
```
sed '1,$a\add one' test.txt 从第一行到最后一行所有行后追加"add one"字符串行

sed '/first/a\add one' test.txt 在匹配到first行追加"add one"字符串行
```
### i命令

```
与a命令类似，只不过在匹配的行前面插入字符串行
sed '/first/i\add one' test.txt 在匹配到first行前面"add one"字符串行
```
### c命令
```
sed '1,$c\add one' test.txt 从第一行到最后一行所有行替换为"add one"字符串行

sed '/first/c\add one' test.txt 将匹配到first行替换为"add one"字符串行
```
### d命令
```
sed '4,$d' test.txt 从第四行到最后一行全部删除
```
### p命令
```
sed -n '/^first.*end$/p' test.txt 以first开头end结尾的所有行全部打印
```
### s命令
```
sed 's/line/text/g' test.txt 将所有行的line替换为text，g代表全局选项，没有g只替换所有行的第一个匹配项

sed '/^first.*end$/s/line/text/g' test.txt 匹配以first开头end结尾的所有行，然后将line全部替换为text

sed 's/\(.*\)line$/\1/g' test.txt 本例中的\(\)中包裹的内容表示正则表达式的第n部分，.*表示任意字符串，所以此例相当于删除所有行末的line

```



















